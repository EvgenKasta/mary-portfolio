<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ú–∞—Ä–∏—è –ú–æ—â–µ–Ω–∫–æ–≤–∞</title>
<style>
html, body { margin:0; padding:0; font-family: "Didot", serif; color:#fff; background:#111; }
#main-screen{text-align:center;padding:0;}
.header{padding-top:20px;margin:0;}
.header h1{margin:0;font-size:28px;}
.header h2{margin:5px 0;font-size:18px;font-weight:normal;}
.header-bar{width:100%;height:2px;background:#fff;margin-top:10px;}
.background-block{background-size:cover;background-repeat:no-repeat;background-position:center;margin:10px 0;padding:20px 0;border-radius:8px;}
.gallery{display:flex;flex-direction:column;align-items:center;gap:20px;}
.gallery img{max-width:80%;height:auto;border-radius:8px;border:3px solid #fff;cursor:pointer;transition:transform 0.2s;}
.gallery img:hover{transform:scale(1.02);}
.about-button{display:block;margin:20px auto;padding:10px 20px;font-size:14px;cursor:pointer;border:2px solid #fff;border-radius:6px;background:#111;color:#fff;}
.instagram-bar{width:100%;height:2px;background:#fff;margin:20px 0 10px 0;}
.instagram-icon{text-align:center;font-size:24px;color:#fff;text-decoration:none;margin-bottom:20px;}
.artwork-page, .about-page{display:none;text-align:center;padding:20px;min-height:100vh;position:relative;background:#111;}
.artwork-slider{max-width:90%;margin:0 auto;position:relative;overflow:hidden;}
.artwork-slider img{width:100%;height:auto;border-radius:8px;transition:transform 0.5s ease;}
.slide-arrow{position:absolute;top:50%;transform:translateY(-50%);font-size:32px;color:#000;background:rgba(255,255,255,0.1);border-radius:50%;padding:8px;cursor:pointer;user-select:none;z-index:10;}
.slide-arrow.left{left:10px;}
.slide-arrow.right{right:10px;}
.slide-dots{display:flex;justify-content:center;margin-top:10px;gap:6px;}
.slide-dot{width:10px;height:10px;border-radius:50%;background-color:rgba(255,255,255,0.3);}
.slide-dot.active{background-color:#fff;}
.artwork-page .description{margin-top:15px;font-size:16px;}
.artwork-page .price{margin-top:5px;font-size:18px;font-weight:bold;}
.back-button{position:absolute;bottom:20px;left:20px;padding:10px 20px;font-size:14px;cursor:pointer;border:2px solid #fff;border-radius:6px;background:#111;color:#fff;}
.about-page img{max-width:90%;height:auto;border-radius:8px;}
.about-page .bio{margin-top:15px;font-size:16px;}
</style>
</head>
<body>

<div id="main-screen">
  <div class="header">
    <h1>–ú–∞—Ä–∏—è –ú–æ—â–µ–Ω–∫–æ–≤–∞</h1>
    <h2>–•—É–¥–æ–∂–Ω–∏–∫ –∏–ª–ª—é—Å—Ç—Ä–∞—Ç–æ—Ä</h2>
    <div class="header-bar"></div>
  </div>

  <div class="background-block">
    <div class="gallery" id="gallery"></div>
  </div>

  <button class="about-button" onclick="openAbout()">–û–±–æ –º–Ω–µ</button>
  <button class="about-button" onclick="openAdmin()">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞–±–æ—Ç—É</button>

  <div class="instagram-bar"></div>
  <a href="https://www.instagram.com/mary_mosch_/" target="_blank" class="instagram-icon">üì∑ Instagram</a>
</div>

<div id="artwork-screen" class="artwork-page">
  <div class="artwork-slider">
    <img id="artwork-img" src="" alt="–ö–∞—Ä—Ç–∏–Ω–∞">
    <div class="slide-arrow left" onclick="prevSlide()">&#10094;</div>
    <div class="slide-arrow right" onclick="nextSlide()">&#10095;</div>
  </div>
  <div class="slide-dots" id="slide-dots"></div>
  <div class="description" id="artwork-desc"></div>
  <div class="price" id="artwork-price"></div>
  <button class="back-button" onclick="goBack()">–ù–∞–∑–∞–¥</button>
</div>

<div id="about-screen" class="about-page">
  <img src="/images/me.JPG" alt="–ú–∞—Ä–∏—è –ú–æ—â–µ–Ω–∫–æ–≤–∞">
  <div class="bio">–Ø —Ö—É–¥–æ–∂–Ω–∏–∫ –ú–∞—Ä–∏—è, 10 –ª–µ—Ç –≤ –∏—Å–∫—É—Å—Å—Ç–≤–µ, –ø–∏—à—É –∫–∞—Ä—Ç–∏–Ω—ã –Ω–∞ –∑–∞–∫–∞–∑ –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ.</div>
  <button class="back-button" onclick="goBackAbout()">–ù–∞–∑–∞–¥</button>
</div>

<div id="admin-screen" class="about-page" style="display:none;">
  <h2>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ä–∞–±–æ—Ç—É</h2>
  <form id="uploadForm">
    <input type="text" id="desc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω—ã" required><br><br>
    <input type="text" id="price" placeholder="–¶–µ–Ω–∞" required><br><br>
    <input type="file" id="images" multiple accept="image/*" required><br><br>
    <button type="submit" class="about-button">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
  </form>
  <button class="back-button" onclick="goBackAdmin()">–ù–∞–∑–∞–¥</button>
</div>

<script>
let artworks = [];

async function loadArtworks() {
  const res = await fetch('/artworks.json');
  artworks = await res.json();
  renderGallery();
}

function renderGallery() {
  const gallery = document.getElementById('gallery');
  gallery.innerHTML = '';
  artworks.forEach((art, i) => {
    const img = document.createElement('img');
    img.src = art.slides[0];
    img.alt = '–ö–∞—Ä—Ç–∏–Ω–∞ ' + (i+1);
    img.onclick = () => openArtwork(i);
    gallery.appendChild(img);
  });
}

let currentArtIndex = 0;
let currentSlideIndex = 0;
const sliderImg = document.getElementById("artwork-img");
const dotsContainer = document.getElementById("slide-dots");

function openArtwork(index) {
  document.getElementById("main-screen").style.display = "none";
  currentArtIndex = index;
  currentSlideIndex = 0;
  showSlide();
  document.getElementById("artwork-screen").style.display = "block";
}

function showSlide() {
  const art = artworks[currentArtIndex];
  sliderImg.src = art.slides[currentSlideIndex];
  document.getElementById("artwork-desc").innerText = art.desc;
  document.getElementById("artwork-price").innerText = art.price;
  renderDots();
}

function renderDots() {
  dotsContainer.innerHTML = '';
  artworks[currentArtIndex].slides.forEach((_, idx) => {
    const dot = document.createElement('div');
    dot.className = 'slide-dot' + (idx === currentSlideIndex ? ' active' : '');
    dotsContainer.appendChild(dot);
  });
}

function prevSlide() {
  const slides = artworks[currentArtIndex].slides;
  currentSlideIndex = (currentSlideIndex - 1 + slides.length) % slides.length;
  showSlide();
}

function nextSlide() {
  const slides = artworks[currentArtIndex].slides;
  currentSlideIndex = (currentSlideIndex + 1) % slides.length;
  showSlide();
}

function goBack() {
  document.getElementById("artwork-screen").style.display = "none";
  document.getElementById("main-screen").style.display = "block";
}

function openAbout() {
  document.getElementById("main-screen").style.display = "none";
  document.getElementById("about-screen").style.display = "block";
}

function goBackAbout() {
  document.getElementById("about-screen").style.display = "none";
  document.getElementById("main-screen").style.display = "block";
}

// --- Admin ---
function openAdmin() {
  const password = prompt("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å:");
  if (!password) return;
  localStorage.setItem("adminPassword", password);
  document.getElementById("main-screen").style.display = "none";
  document.getElementById("admin-screen").style.display = "block";
}

function goBackAdmin() {
  document.getElementById("admin-screen").style.display = "none";
  document.getElementById("main-screen").style.display = "block";
}

document.getElementById("uploadForm").addEventListener("submit", async e => {
  e.preventDefault();
  const desc = document.getElementById("desc").value;
  const price = document.getElementById("price").value;
  const files = document.getElementById("images").files;
  const password = localStorage.getItem("adminPassword");

  const base64Images = await Promise.all([...files].map(f => new Promise(r=>{
    const reader = new FileReader();
    reader.onload=()=>r(reader.result);
    reader.readAsDataURL(f);
  })));

  const res = await fetch("/api/upload", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ password, desc, price, images: base64Images })
  });

  const data = await res.json();
  if(data.success){
    alert("‚úÖ –†–∞–±–æ—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞!");
    artworks.push({slides:data.urls,desc,price});
    renderGallery();
    goBackAdmin();
  }else{
    alert("‚ùå –û—à–∏–±–∫–∞: " + (data.error||'–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è'));
  }
});

loadArtworks();
</script>

</body>
</html>
